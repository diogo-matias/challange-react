{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\nimport { api } from \"../../services/api\";\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nvar initialState = {\n  token: null,\n  user: null,\n  isAuthenticated: false,\n  isLoading: false,\n  error: null\n};\nexport var login = createAsyncThunk('auth/login', function () {\n  var _ref2 = _asyncToGenerator(function* (credentials, _ref) {\n    var rejectWithValue = _ref.rejectWithValue;\n    try {\n      var response = yield api.post('/auth/login', credentials);\n      var _response$data = response.data,\n        access_token = _response$data.access_token,\n        user = _response$data.user;\n      yield AsyncStorage.setItem('authToken', access_token);\n      api.defaults.headers.common['Authorization'] = `Bearer ${access_token}`;\n      return {\n        token: access_token,\n        user: user\n      };\n    } catch (error) {\n      var _error$response, _error$response$data;\n      return rejectWithValue(((_error$response = error.response) == null ? void 0 : (_error$response$data = _error$response.data) == null ? void 0 : _error$response$data.message) || 'Erro no login');\n    }\n  });\n  return function (_x, _x2) {\n    return _ref2.apply(this, arguments);\n  };\n}());\nexport var logout = createAsyncThunk('auth/logout', function () {\n  var _ref4 = _asyncToGenerator(function* (_, _ref3) {\n    var rejectWithValue = _ref3.rejectWithValue;\n    try {\n      yield AsyncStorage.removeItem('authToken');\n      delete api.defaults.headers.common['Authorization'];\n      return null;\n    } catch (error) {\n      return rejectWithValue('Erro no logout');\n    }\n  });\n  return function (_x3, _x4) {\n    return _ref4.apply(this, arguments);\n  };\n}());\nexport var checkAuth = createAsyncThunk('auth/checkAuth', function () {\n  var _ref6 = _asyncToGenerator(function* (_, _ref5) {\n    var rejectWithValue = _ref5.rejectWithValue;\n    try {\n      var token = yield AsyncStorage.getItem('authToken');\n      if (!token) {\n        throw new Error('No token found');\n      }\n      api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n      var response = yield api.get('/auth/profile');\n      return {\n        token: token,\n        user: response.data\n      };\n    } catch (error) {\n      yield AsyncStorage.removeItem('authToken');\n      delete api.defaults.headers.common['Authorization'];\n      return rejectWithValue('Token inválido');\n    }\n  });\n  return function (_x5, _x6) {\n    return _ref6.apply(this, arguments);\n  };\n}());\nvar authSlice = createSlice({\n  name: 'auth',\n  initialState: initialState,\n  reducers: {\n    clearError: function clearError(state) {\n      state.error = null;\n    }\n  },\n  extraReducers: function extraReducers(builder) {\n    builder.addCase(login.pending, function (state) {\n      state.isLoading = true;\n      state.error = null;\n    }).addCase(login.fulfilled, function (state, action) {\n      state.isLoading = false;\n      state.isAuthenticated = true;\n      state.token = action.payload.token;\n      state.user = action.payload.user;\n    }).addCase(login.rejected, function (state, action) {\n      state.isLoading = false;\n      state.error = action.payload;\n    }).addCase(logout.fulfilled, function (state) {\n      state.token = null;\n      state.user = null;\n      state.isAuthenticated = false;\n    }).addCase(checkAuth.pending, function (state) {\n      state.isLoading = true;\n    }).addCase(checkAuth.fulfilled, function (state, action) {\n      state.isLoading = false;\n      state.isAuthenticated = true;\n      state.token = action.payload.token;\n      state.user = action.payload.user;\n    }).addCase(checkAuth.rejected, function (state) {\n      state.isLoading = false;\n      state.isAuthenticated = false;\n      state.token = null;\n      state.user = null;\n    });\n  }\n});\nvar clearError = authSlice.actions.clearError;\nexport { clearError };\nexport default authSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","api","AsyncStorage","initialState","token","user","isAuthenticated","isLoading","error","login","_ref2","_asyncToGenerator","credentials","_ref","rejectWithValue","response","post","_response$data","data","access_token","setItem","defaults","headers","common","_error$response","_error$response$data","message","_x","_x2","apply","arguments","logout","_ref4","_","_ref3","removeItem","_x3","_x4","checkAuth","_ref6","_ref5","getItem","Error","get","_x5","_x6","authSlice","name","reducers","clearError","state","extraReducers","builder","addCase","pending","fulfilled","action","payload","rejected","actions","reducer"],"sources":["C:/Users/diogo/OneDrive/Desktop/learning/loja-challenge/frontend/src/store/slices/authSlice.ts"],"sourcesContent":["import { createSlice, createAsyncThunk, PayloadAction } from '@reduxjs/toolkit';\r\nimport { AuthState, LoginData } from '../types';\r\nimport { api } from '../../services/api';\r\nimport AsyncStorage from '@react-native-async-storage/async-storage';\r\n\r\nconst initialState: AuthState = {\r\n  token: null,\r\n  user: null,\r\n  isAuthenticated: false,\r\n  isLoading: false,\r\n  error: null,\r\n};\r\n\r\nexport const login = createAsyncThunk(\r\n  'auth/login',\r\n  async (credentials: LoginData, { rejectWithValue }) => {\r\n    try {\r\n      const response = await api.post('/auth/login', credentials);\r\n      const { access_token, user } = response.data;\r\n      \r\n      await AsyncStorage.setItem('authToken', access_token);\r\n      api.defaults.headers.common['Authorization'] = `Bearer ${access_token}`;\r\n      \r\n      return { token: access_token, user };\r\n    } catch (error: any) {\r\n      return rejectWithValue(error.response?.data?.message || 'Erro no login');\r\n    }\r\n  }\r\n);\r\n\r\nexport const logout = createAsyncThunk(\r\n  'auth/logout',\r\n  async (_, { rejectWithValue }) => {\r\n    try {\r\n      await AsyncStorage.removeItem('authToken');\r\n      delete api.defaults.headers.common['Authorization'];\r\n      return null;\r\n    } catch (error: any) {\r\n      return rejectWithValue('Erro no logout');\r\n    }\r\n  }\r\n);\r\n\r\nexport const checkAuth = createAsyncThunk(\r\n  'auth/checkAuth',\r\n  async (_, { rejectWithValue }) => {\r\n    try {\r\n      const token = await AsyncStorage.getItem('authToken');\r\n      if (!token) {\r\n        throw new Error('No token found');\r\n      }\r\n      \r\n      api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n      const response = await api.get('/auth/profile');\r\n      \r\n      return { token, user: response.data };\r\n    } catch (error: any) {\r\n      await AsyncStorage.removeItem('authToken');\r\n      delete api.defaults.headers.common['Authorization'];\r\n      return rejectWithValue('Token inválido');\r\n    }\r\n  }\r\n);\r\n\r\nconst authSlice = createSlice({\r\n  name: 'auth',\r\n  initialState,\r\n  reducers: {\r\n    clearError: (state: AuthState) => {\r\n      state.error = null;\r\n    },\r\n  },\r\n  extraReducers: (builder) => {\r\n    builder\r\n      // Login\r\n      .addCase(login.pending, (state: AuthState) => {\r\n        state.isLoading = true;\r\n        state.error = null;\r\n      })\r\n      .addCase(login.fulfilled, (state: AuthState, action) => {\r\n        state.isLoading = false;\r\n        state.isAuthenticated = true;\r\n        state.token = action.payload.token;\r\n        state.user = action.payload.user;\r\n      })\r\n      .addCase(login.rejected, (state: AuthState, action) => {\r\n        state.isLoading = false;\r\n        state.error = action.payload as string;\r\n      })\r\n      // Logout\r\n      .addCase(logout.fulfilled, (state: AuthState) => {\r\n        state.token = null;\r\n        state.user = null;\r\n        state.isAuthenticated = false;\r\n      })\r\n      // Check Auth\r\n      .addCase(checkAuth.pending, (state: AuthState) => {\r\n        state.isLoading = true;\r\n      })\r\n      .addCase(checkAuth.fulfilled, (state: AuthState, action) => {\r\n        state.isLoading = false;\r\n        state.isAuthenticated = true;\r\n        state.token = action.payload.token;\r\n        state.user = action.payload.user;\r\n      })\r\n      .addCase(checkAuth.rejected, (state: AuthState) => {\r\n        state.isLoading = false;\r\n        state.isAuthenticated = false;\r\n        state.token = null;\r\n        state.user = null;\r\n      });\r\n  },\r\n});\r\n\r\nexport const { clearError } = authSlice.actions;\r\nexport default authSlice.reducer; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}